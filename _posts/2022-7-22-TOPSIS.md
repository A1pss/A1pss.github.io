---
title: 第二讲：用熵权法定权重的TOPSIS(优劣解距离法)
layout: post
post-image: "https://alps-images.obs.cn-east-2.myhuaweicloud.com/img/image-20230722185917433.png"
description: 数学建模算法笔记
tags:
- mathematics modeling
- knowledge
---


> **声明：**
>
> 笔记为本人个人整理，参考清风大佬的视频课件，若有错误请指出。


## 适用范围
- 比较的对象一般远大于两个
- 比较的指标往往不只是一个方面
## 具体步骤
1. 将原始矩阵正向化
	
	 | 指标名称         | 指标特点         | 例子                    |
	  | ---------------- | ---------------- | ----------------------- |
	  | 极大型（效益型） | 越大（多）越好   | 成绩、GDP增速、企业利润 |
	  | 极小型（成本型） | 越小（少）越好   | 费用、坏品率、污染程度  |
	  | 中间型           | 越接近某个值越好 | 水质量评估时的PH值      |
	  | 区间型指标       | 落在某个区间最好 | 体温、水中植物营养物量  |
	
	- 极小型 ![](https://www.zhihu.com/equation?tex=%5Crightarrow) 极大型
	
	  ![](https://www.zhihu.com/equation?tex=%0A%09%20%20%5Cbegin%7Bcases%7D%5C%20max-x%2C%5C%20%E9%80%9A%E7%94%A8%5C%5C%5C%20%5Cfrac%7B1%7D%7Bx%7D%2C%5C%20%E5%A6%82%E6%9E%9C%E6%89%80%E6%9C%89%E7%9A%84%E5%85%83%E7%B4%A0%E5%9D%87%E4%B8%BA%E6%AD%A3%E6%95%B0%5Cend%7Bcases%7D%0A%09%20%20)
	
	- 中间型 ![](https://www.zhihu.com/equation?tex=%5Crightarrow) 极大型
	
	  <img src="https://alps-images.obs.cn-east-2.myhuaweicloud.com/img/image-20230722195125328.png" alt="image-20230722195125328" style="zoom:67%;" />
	
	- 区间型 ![](https://www.zhihu.com/equation?tex=%5Crightarrow) 极大型
	
	  <img src="https://alps-images.obs.cn-east-2.myhuaweicloud.com/img/image-20230722195154679.png" alt="image-20230722195154679" style="zoom:67%;" />


2. 正向化矩阵标准化

	- 将正向化矩阵记作![](https://www.zhihu.com/equation?tex=X)，对其标准化的矩阵记为![](https://www.zhihu.com/equation?tex=Z)，则![](https://www.zhihu.com/equation?tex=Z)为![](https://www.zhihu.com/equation?tex=X)中每个元素/![](https://www.zhihu.com/equation?tex=%5Csqrt%7B%E5%85%B6%E6%89%80%E5%9C%A8%E5%88%97%E7%9A%84%E5%85%83%E7%B4%A0%E7%9A%84%E5%B9%B3%E6%96%B9%E5%92%8C%7D)：
	
	

![](https://www.zhihu.com/equation?tex=%0A%09z_%7Bij%7D%3Dx_%7Bij%7D/%5Csqrt%7B%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%7BX_%7Bij%7D%5E2%7D%7D%0A%09)

如果Z矩阵中存在负数，则需要对第i个样本使用以下的标准化方法重新标准化：

![](https://www.zhihu.com/equation?tex=%0A%09%20%20%5Cwidetilde%7Bz_%7Bij%7D%7D%3D%5Cfrac%7Bx_%7Bij%7D-min%5C%7Bx_%7B1j%7D%2Cx_%7B2j%7D%2C%5Ccdots%2Cx_%7Bnj%7D%5C%7D%7D%7Bmax%5C%7Bx_%7Bij%7D%2Cx_%7B2j%7D%2C%5Ccdots%2Cx_%7Bnj%7D%5C%7D-min%5C%7Bx_%7Bij%7D%2Cx_%7B2j%7D%2C%5Ccdots%2Cx_%7Bnj%7D%5C%7D%7D%0A%09%20%20)


​	
3. 计算第![](https://www.zhihu.com/equation?tex=j)项指标下第![](https://www.zhihu.com/equation?tex=i)个样本所占的比重，并将其看作相对熵中用到的概率：
   
    *（各元素值除以该元素所在列的和）*
    

![](https://www.zhihu.com/equation?tex=%0A%20%20%20%20P_%7Bij%7D%3D%5Cfrac%7B%5Cwidetilde%7Bz_%7Bij%7D%7D%7D%7B%5Csum_%7Bi%3D1%7D%5En%7B%5Cwidetilde%7Bz_%7Bij%7D%7D%7D%7D%0A%20%20%20%20)


4. 计算每个指标的熵权：
   

![](https://www.zhihu.com/equation?tex=%0A%20%20%20%20e_j%3D-%5Cfrac%7B1%7D%7B%5Cln%20n%7D%5Csum_%7Bi%3D1%7D%5En%7Bp_%7Bij%7D%5Cln%20%28p_%7Bij%7D%29%7D%5C%20%28j%3D1%2C2%2C%5Ccdots%2Cm%29%5C%5Cd_j%3D1-e_j%5C%5CW_j%3Dd_j/%5Csum_%7Bj%3D1%7D%5Em%7Bd_j%7D%5C%20%28j%3D1%2C2%2C%5Cdots%2Cm%29%0A%20%20%20%20)


3. 计算得分并归一化

​	定义最大值![](https://www.zhihu.com/equation?tex=Z%5E%2B%3D%28Z_1%5E%2B%2CZ_2%5E%2B%2C%5Cdots%2CZ_m%5E%2B%29%5C%5C%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%3D%E7%9F%A9%E9%98%B5%E6%AF%8F%E5%88%97%E5%8F%96%E6%9C%80%E5%A4%A7%E5%80%BC%E7%BB%84%E6%88%90%E7%9A%84%E8%A1%8C%E5%90%91%E9%87%8F)

​	定义最小值![](https://www.zhihu.com/equation?tex=Z%5E-%3D%28Z_1%5E-%2CZ_2%5E-%2C%5Cdots%2CZ_m%5E-%29%5C%5C%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%5C%20%3D%E7%9F%A9%E9%98%B5%E6%AF%8F%E5%88%97%E5%8F%96%E6%9C%80%E5%B0%8F%E5%80%BC%E7%BB%84%E6%88%90%E7%9A%84%E8%A1%8C%E5%90%91%E9%87%8F)

​	第![](https://www.zhihu.com/equation?tex=i)个评价对象与最大值的距离![](https://www.zhihu.com/equation?tex=D_i%5E%2B%3D%5Csqrt%7B%5Csum_%7Bj%3D1%7D%5E%7Bm%7D%7BW_j%28Z_j%5E%2B-z_%7Bij%7D%29%5E2%7D%7D)

​	第![](https://www.zhihu.com/equation?tex=i)个评价对象与最小值的距离![](https://www.zhihu.com/equation?tex=D_i%5E-%3D%5Csqrt%7B%5Csum_%7Bj%3D1%7D%5E%7Bm%7D%7BW_j%28Z_j%5E--z_%7Bij%7D%29%5E2%7D%7D)

​	第![](https://www.zhihu.com/equation?tex=i)个评价对象未归一化的得分：![](https://www.zhihu.com/equation?tex=S_i%3D%5Cfrac%7BD_i%5E-%7D%7BD_i%5E%2B%2BD_i%5E-%7D)

​	归一化后得分：![](https://www.zhihu.com/equation?tex=%5Cwidetilde%7BS_i%7D%3DS_i/%5Csum_%7Bi%3D1%7D%5En%7BS_i%7D)

## 熵权法

### 定义

- 原理：指标的变异程度越小，所反映的信息量也越少，其对应的权值也应该越低

  > 解释：即越有可能发生的事情（概率越大），信息量越少；越不可能发生的事情（概率越小），信息量越多

- 如何度量信息量的大小？

  信息量用![](https://www.zhihu.com/equation?tex=I)表示，概率用![](https://www.zhihu.com/equation?tex=p)表示，![](https://www.zhihu.com/equation?tex=x)代表事件![](https://www.zhihu.com/equation?tex=X)可能发生的某种情况，![](https://www.zhihu.com/equation?tex=p%28x%29)表示这种情况发生的概率

  我们可以定义：![](https://www.zhihu.com/equation?tex=I%28x%29%3D-%5Cln%20%28p%28x%29%29)

  事件![](https://www.zhihu.com/equation?tex=X)的信息熵：![](https://www.zhihu.com/equation?tex=H%28X%29%3D%5Csum_%7Bi%3D1%7D%5En%7B%5Bp%28x_i%29%7DI%28x_i%29%5D%3D-%5Csum_%7Bi%3D1%7D%5En%7B%5Bp%28x_i%29%5Cln%20%28p%28x_i%29%29%5D%7D)

- 对于熵权法而言，信息熵越大信息量越小

  因为我们关注的是已有信息，随机变量的信息熵越大，则它的值（内容）能给你补充的信息量越大，而知道这个值前已有的信息量越小

- 对于比赛来说，熵权法可以随便用；

  对于论文来说，熵权法就是扯淡

## 代码

1. ME_TOPSIS.m

   ```matlab
   %% 将数据复制到工作区，并将矩阵命名为X
   %% 判断矩阵是否需要正向化
   [n,m] = size(X);
   judge = input(['这' num2str(m) '个指标是否需要经过正向化处理，需要则输入1，不需要则输入0：']);
   if judge == 1
       Position = input('输入需要正向化处理的列，如：[1,2,3]：');
       disp('输入这些列各自的指标类型（1：极小型，2：中间型，3：区间型），如：[2,1,3]：')
       Type = input('例如：第2列是极小型，第3列是区间型，第6列是中间型，就输入[1,3,2]：');
       for i = 1 : size(Position,2)
           X(:,Position(i)) = Positivization(X(:,Position(i)),Type(i),Position(i));
       end
       disp('正向化后的矩阵 X = ');
       disp(X)
   end
   %% 标准化
   Z = X ./ repmat(sum(X.*X) .^ 0.5, n, 1);
   disp('标准化矩阵Z = ');
   disp(Z)
   %% 计算熵权
   [n,m] = size(Z);
   D = zeros(1,m);  % 初始化保存信息效用值的行向量
   for i = 1:m
       x = Z(:,i);  % 取出第i列的指标
       p = x / sum(x);
       % 注意，p有可能为0，此时计算ln(p)*p时，Matlab会返回NaN，所以这里我们自己定义一个函数
       e = -sum(p .* mylog(p)) / log(n); % 计算信息熵
       D(i) = 1- e; % 计算信息效用值
   end
   W = D ./ sum(D);  % 将信息效用值归一化，得到权重
   %% 判断是否需要增加权重向量
   disp("是否需要增加权重向量，需要输入1，不需要输入0")
   Judge = input('输入是否需要增加权重：');
   if Judge == 1
       weigh = W;
       OK = 0;  % 用来判断用户的输入格式是否正确
       while OK == 0 
           if abs(sum(weigh) - 1)<0.000001 && size(weigh,1) == 1 && size(weigh,2) == m   % 这里要注意浮点数的运算是不精准的。
                OK =1;
           else
               weigh = input('你输入的有误，请重新输入权重行向量: ');
           end
       end
   else
       weigh = ones(1,m) ./ m ; %如果不需要加权重就默认权重都相同，即都为1/m
   end
   %% 算出得分
   D_P = sum([(Z - repmat(max(Z),n,1)) .^ 2 ] .* repmat(weigh,n,1) ,2) .^ 0.5;   % D+ 与最大值的距离向量
   D_N = sum([(Z - repmat(min(Z),n,1)) .^ 2 ] .* repmat(weigh,n,1) ,2) .^ 0.5;   % D- 与最小值的距离向量
   S = D_N ./ (D_P+D_N);    % 未归一化的得分
   disp('最后的得分为：')
   stand_S = S / sum(S)
   [sorted_S,index] = sort(stand_S ,'descend')
   ```

   