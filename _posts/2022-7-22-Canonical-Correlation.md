---
title: 第六讲 ：典型相关分析
layout: post
post-image: "https://alps-images.obs.cn-east-2.myhuaweicloud.com/img/image-20230722185917433.png"
description: 数学建模算法笔记
tags:
- mathematics modeling
- knowledge
---


> **声明：**
>
> 笔记为本人个人整理，参考清风大佬的视频课件，若有错误请指出。


典型相关分析(Canonical Correlation analysis)是研究两组变量(每组变量中都可能有多个指标)之间相关关系的一种多元统计方法。它能够揭示出两组变量之间的内在联系。

> 温馨提示：这一讲涉及到多元统计的知识，如果对原理听不懂也没有关系，等以后学完了主成分分析模型后再回过头来看比较合适。

---

## 数学原理

### 典型相关的基本理论

#### 典型相关分析的基本思想(略)

假设两组变量分别为: 
$$
X^{(1)}=(X_1^{(1)},X_2^{(1)},\cdots,X_p^{(1)}),\ X^{(2)}=(X_1^{(2)},X_2^{(2)},\cdots,X_q^{(2)})
$$
分别在两组变量中选取若干有代表性的综合变量 $U_i,V_i$，使得，每一个综合变量是原变量的线性组合，即
$$
U_i=a_1^{(i)}X_1^{(1)}+a_2^{(i)}X_2^{(1)}+\cdots+a_p^{(i)}X_p^{(1)}\triangleq a^{(i)'}X^{(1)}\\V_i=b_1^{(i)}X_1^{(2)}+b_2^{(i)}X_2^{(2)}+\cdots+b_q^{(i)}X_q^{(2)}\triangleq b^{(i)'}X^{(2)}
$$
第一组在$var(U_1)=var(V_1)=1$满足的条件下，找到$a^{(1)}$和$b^{(1)}$两组系数，使得$\rho(U_1,V_1)$最大。

被选出的线性组合称为==典型变量==，他们的相关系数称为==典型相关系数==。

还需要保证两组的信息不相关:
$$
cov(U_1,U_2)=cov(V_1,V_2)=0
$$

> 注: 综合变量的组数是不确定的，如果第一组就能代表原数据样本大部分的信息，那么一组就够。
>

#### 典型相关分析原理及方法(详)

- 设有两组随机变量，$X^{(1)}$代表第一组的p个变量，$X^{(2)}$代表第二组的q个变量，假设$p\leqslant q$。令
  $$
  Cov(X^{(1)})=\Sigma_{11},\\Cov(X^{(2)})=\Sigma_{22},\\Cov(X^{(1)},X^{(2)})=\Sigma_{12}=\Sigma_{21}'\\\therefore Cov(X,X)=\begin{bmatrix} \mathop{\Sigma_{11}} \limits_{(p\times p)} & \mathop{\Sigma_{12}} \limits_{(p\times p)} \\ \mathop{\Sigma_{21}} \limits_{(p\times p)} & \mathop{\Sigma_{22}} \limits_{(p\times p)} \end{bmatrix}
  $$
  
- 设两组变量的线性组合分别为：
  $$
  U=a_1X_1^{(1)}+a_2X_2^{(1)}+\cdots+a_pX_p^{(1)}\triangleq a'X^{(1)}\\V=b_1X_1^{(2)}+b_2X_2^{(2)}+\cdots+b_qX_q^{(2)}\triangleq b'X^{(2)}
  $$
  易见
  $$
  D(U)=D(a'X^{(1)})=a'Cov(X^{(1)},X^{(1)})a=a'\Sigma_{11}a=1\\D(V)=D(b'X^{(2)})=b'Cov(X^{(2)},X^{(2)})b=b'\Sigma_{11}b=1\\Cov(U,V)=a'Cov(X^{(1)},X^{(2)})b=a'\Sigma_{12}b\\Corr(U,V)=\frac{Cov(U,V)}{\sqrt{D(U)}\sqrt{D(V)}}=\frac{a'\Sigma_{12}b}{\sqrt{a'\Sigma_{11}a}\sqrt{b'\Sigma_{22}b}}
  \\\therefore Corr(U,V)=a'\Sigma_{12}b
  $$
  
- 问题就变成在U和V的方差为一的约束条件下，求使$Corr(U,V)=a'\Sigma_{12}b$达到最大的系数向量a与b。

- 根据条件极值的求法引入Lagrange乘数，将问题转化为求
  $$
  \phi(a,b)=a'\Sigma_{12}b-\frac{\lambda}{2}(a'\Sigma_{11}a-1)-\frac{\nu}{2}(b'\Sigma_{22}b-1)
  $$
  的极大值，其中$\lambda,\nu$是Lagrange乘数。

- 根据求极值的必要条件得$\cases{\frac{\partial\phi}{\partial a}=\Sigma_{12}b-\lambda\Sigma_{11}a=0\\\frac{\partial\phi}{\partial a}=\Sigma_{21}b-\lambda\Sigma_{22}a=0}$
  $$
  \Rightarrow \cases{\Sigma_{12}b-\lambda\Sigma_{11}a=0\\\Sigma_{21}b-\lambda\Sigma_{22}a=0}
  $$

  > [常用的向量矩阵求导公式](https://blog.csdn.net/lipengcn/articla/details/52815429)

- 假定个随机变量协差阵的逆矩阵存在，得：
  $$
  \cases{(\Sigma_{11}^{-1}\Sigma_{12}\Sigma_{22}^{-1}\Sigma_{21}-\lambda^2I_p)a=0 \\ (\Sigma_{22}^{-1}\Sigma_{21}\Sigma_{11}^{-1}\Sigma_{12}-\lambda^2I_q)b=0}
  $$
  ==令$A=\Sigma_{11}^{-1}\Sigma_{12}\Sigma_{22}^{-1}\Sigma_{21}$， $B=\Sigma_{22}^{-1}\Sigma_{21}\Sigma_{11}^{-1}\Sigma_{12}$==  (其中A为p\*p阶矩阵，B为q\*q阶矩阵)

  其中$\lambda^2$为A和B的特征根，a,b则是对应的特征向量。

- 因为$\lambda=a'\Sigma_{12}b=Corr(U,V)$，求Corr(U,V)最大值也就是求$\lambda$的最大值，也就是求A和B得最大特征根的开平方

  可证明：A和B具有相同非零特征根，且所有特征根非负，位于0~1之间

- 因此，我们得到 $a^{(1)}=(a_1^{(1)},a_2^{(1)},\cdots,a_p^{(1)}),\ a^{(2)}=(a_1^{(2)},a_2^{(2)},\cdots,a_q^{(2)})$ 就是所求的典型变量的系数向量，我们称
  $$
  U_1=a^{(1)'}X^{(1)}=a_1^{(1)}X_1^{(1)}+a_2^{(1)}X_2^{(1)}+\cdots+a_p^{(1)}X_p^{(1)}\\V_1= b^{(1)'}X^{(2)}=b_1^{(1)}X_1^{(2)}+b_2^{(1)}X_2^{(2)}+\cdots+b_q^{(1)}X_q^{(2)}
  $$
  为第一对典型变量，最大特征根的平方根$\lambda_1$即为两典型变量的相关系数，我们称其为第一典型相关系数。

- 如果第一典型变量不足以代表两组原始变量的信息，则需要第二对典型变量除需要满足$D(U_2)=D(V_2)=1$外，还要增加约束条件: $cov(U_1,U_2)=cov(V_1,V_2)=0$

  那么$\lambda_2$为第二典型相关系数，对相应的$U_2=a^{(2)'}X^{(1)},\ V_2=b^{(2)'}X^{(2)}$为第二对典型变量。

  类似的，一次可求出第r对典型变量和典型相关系数。

### 样本典型相关分析

#### 典型相关系数的显著性检验

1. (在论文中直接说)假设$\begin{bmatrix} X^{(1)} \\ X^{(2)} \end{bmatrix}$服从正态分布$N_{p+q}(\mu,\Sigma)$，从该总体中抽取样本容量为n的样本，得到下列数据矩阵：
   $$
   X^{(1)}=\begin{bmatrix} X_{11}^{(1)} & X_{12}^{(1)} & \cdots & X_{1p}^{(1)} \\ X_{21}^{(1)} & X_{22}^{(1)} & \cdots & X_{2p}^{(1)} \\ \vdots & \vdots & \ddots & 
   \vdots \\ X_{n1}^{(1)} & X_{n2}^{(1)} & \cdots & X_{np}^{(1)} \end{bmatrix}
   $$

   $$
   X^{(2)}=\begin{bmatrix} X_{11}^{(2)} & X_{12}^{(2)} & \cdots & X_{1p}^{(2)} \\ X_{21}^{(2)} & X_{22}^{(2)} & \cdots & X_{2p}^{(2)} \\ \vdots & \vdots & \ddots & 
   \vdots \\ X_{n1}^{(2)} & X_{n2}^{(2)} & \cdots & X_{np}^{(2)} \end{bmatrix}
   $$

2. (不是必须的，3中有重复步骤)在典型相关分析时，就两组变量得相关性进行检验。即检验假设
   $$
   H_0:Corr(U,V)=0,\ H_1:Corr(U,V)\neq 0
   $$
   p值小于0.05(0.1)表示在95%(90%)的置信水平下拒绝原假设，即认为两组变量有关。

3. 对典型相关系数进行检验。检验假设为：
   $$
   H_0:\lambda_{k+1}=\lambda_{k+2}=\cdots=\lambda_r\\H_1:\lambda_{k+1}\neq 0
   $$
   这个检验假设是一个递推的过程，首先看$\lambda_{k+1}$是否等于0，不等于再检验$\lambda_{k+2}$，以此类推，直到遇到等于0的典型相关系数就停止。

   判断$\lambda$是否等于0的方法是看它对应的p值

#### 利用标准化后的典型相关变量分析问题

在典型相关分析之前应先对数据做标准化交换处理。经标准化变换之后的协差阵就是相关系数矩阵，因而，也即通常应从相关矩阵出发进行典型相关分析。

#### 典型载荷分析

指原始变量与典型变量之间相关性分析。

==典型载荷和典型变量对应的相关系数的区别?==

#### 冗余分析

计算前r个典型变量对样本总方差的贡献，即已解释的方差比例。

由自身几个典型变量解释的方差比例算法：

第一典型变量解释的方差比例$=(\frac{\sum{第一典型变量中的变量^2}}{第一典型变量中变量的个数(p,q)})$

第二、第三等典型变量解释的方差比例计算方法同上

## SPSS操作

1. 导入数据

   文件-导入数据(一般选择Excel)

2. 检验数据类型

   点击左下角<kbd>变量试图</kbd> ，在“测量”列将数据类型调整

   标度：数字型，例如身高，体重等

   有序：有序的分类变量，例如甲乙丙丁，优良差

   名义：没有顺序的分类变量，例如男女

3. 运行典型相关分析

   分析-相关-典型相关性，将数据移动到对应的集合

4. 导出数据结果

   文件-导出，一般保存为WordRTF(*.doc)类型，文件名行为保存位置

5. 对结果进行分析

   - 得到典型相关系数

     将《典型相关性》表格改为《典型相关系数》，第一列改为“相关系数”，最后一列改为“p值”。我们要通过p值列确定典型相关系数的个数。首先将置信水平确定 (90%, 95%, 99%), 确定方法为看第一行p值是否小于0.05，小于的话首选95%，大于的话调整成为90%，如果后面p值较多小于0.05的话调整为99%。

     确定好置信水平后，，先看第一个数是否小于对应的显著性水平 (0.1, 0.05, 0.01)，小于的话看第二个数是否小于显著性水平，依此类推直到一个数大于显著性水平为止。所有大于显著性水平的p值的格式就是典型相关系数的个数，对应的“相关系数”列就是典型相关系数。

   - 得到典型相关变量对应的线性组合系数

     将《标准化/非标准化典型相关系数》表格改为《标准化/非标准化典型相关变量对应的线性组合系数》，变量1, 2, 3, ...对应的是第几个典型变量(符合典型相关系数的个数)

     然后写成
     $$
     U_i^*=a_1^{(i)}X_1^{(1)}+a_2^{(i)}X_2^{(1)}+\cdots+a_p^{(i)}X_p^{(1)}\\V_i^*=b_1^{(i)}X_1^{(2)}+b_2^{(i)}X_2^{(2)}+\cdots+b_q^{(i)}X_q^{(2)}
     $$
     的形式(*代表标准化后的典型变量，i代表第i个典型变量)
     
   - 典型载荷
   
     正数即正相关，负数即负相关，绝对值越大相关性越强
   
     在论文中可以解释一下典型载荷分析的结果，例如：结果说明，生理指标的第一典型变量与体重的相关系数为-0.621，与腰围的相关系数为-0.925，与脉搏的相关系数为0.333。从另一方面说明生理指标的第一对典型变量与体重、腰围负相关，而与脉搏正相关。其中与腰围的相关性最强。第一对典型变量主要反映了体形的胖瘦。
   
   - 冗余分析
   
     指前r个典型变量对样本总方差的贡献。看《已解释的方差比例》中集合1 * 自身和集合2 * 自身两列数据中的前 i 行( i 为典型相关系数的个数)
   
     

​     



   

